Iceberg Chart Explainer (Supabase Edition)
Welcome to the Iceberg Chart Explainer! This Flask web application provides a dynamic and interactive way to explore iceberg charts. It's powered by a Supabase backend for data storage and management, and it uses Google's Gemini and Custom Search APIs to generate rich, context-aware explanations for each chart entry.

Features
Dynamic Chart Loading: All iceberg charts are loaded directly from a Supabase database.

Interactive UI: A clean and modern interface for viewing charts, with layers that get progressively deeper.

AI-Powered Explanations: Click any entry to get a detailed explanation generated by Google's Gemini, with context provided by Google Custom Search.

Full CRUD Management: A dedicated web interface to Create, Read, Update, and Delete charts, layers, and entries without touching any code.

Easy Migration: Includes a script to easily migrate your existing local .json iceberg charts into the Supabase database.

Getting Started
Follow these steps to get the application running on your local machine.

1. Prerequisites
Before you begin, ensure you have the following installed:

Python 3.8 or newer

pip (Python package installer)

A free Supabase account

2. Supabase Database Setup
First, you need to set up the database tables in your Supabase project.

Create a New Supabase Project: Log in to your Supabase account and create a new project.

Run the SQL Schema: Navigate to the SQL Editor in your new project's dashboard. Copy the entire content of the supabase_schema.sql file provided in this repository and run it. This will create the required tables (iceberg_charts, iceberg_layers, iceberg_entries) and set up the necessary access policies.

Get API Credentials: Go to Project Settings > API. You will need two values from this page for the next step:

Project URL

anon (public) key

3. Local Project Installation
Now, let's set up the project on your computer.

Clone the Repository:

git clone <repository_url>
cd iceberg-explainer

Create a Virtual Environment: It's highly recommended to use a virtual environment to manage project dependencies.

# Create the environment
python -m venv venv

# Activate it
# On Windows:
.\venv\Scripts\activate
# On macOS/Linux:
source venv/bin/activate

Install Dependencies: Install all the required Python packages from the requirements.txt file.

pip install -r requirements.txt

4. Configure Environment Variables
The application requires API keys to connect to Supabase and Google services.

Create a .env file in the root directory of the project.

Add your credentials to this file. Replace the placeholder values with your actual keys.

# --- Google API Keys ---
# Get from Google AI Studio ([https://aistudio.google.com/app/apikey](https://aistudio.google.com/app/apikey))
GEMINI_API_KEY=YOUR_GEMINI_API_KEY

# Get by setting up a Custom Search Engine ([https://developers.google.com/custom-search/v1/overview](https://developers.google.com/custom-search/v1/overview))
CUSTOM_SEARCH_API_KEY=YOUR_CUSTOM_SEARCH_API_KEY
CUSTOM_SEARCH_ENGINE_ID=YOUR_CUSTOM_SEARCH_ENGINE_ID

# --- Supabase Credentials ---
# Get from your Supabase Project's API Settings
SUPABASE_URL=YOUR_SUPABASE_PROJECT_URL
SUPABASE_ANON_KEY=YOUR_SUPABASE_ANON_KEY

5. Migrate Existing Data (Optional)
If you have existing iceberg charts as .json files, you can easily upload them to your Supabase database.

Create an icebergs directory in the project's root folder.

Place your .json files inside this directory.

Run the migration script:

python migrate_to_supabase.py

The script will connect to your Supabase project and populate the tables with the data from your JSON files. You only need to do this once.

6. Run the Application
You're all set! Start the Flask development server with the following command:

flask run

Open your web browser and navigate to http://127.0.0.1:5000.

How to Use the App
Main Page: The homepage displays all the iceberg charts currently in your database. Click on any chart to view it.

Iceberg View: On the chart page, click any entry. A side panel will appear with an AI-generated explanation of that topic.

Management Interface: To add, edit, or delete charts, navigate to /manage. From here, you can:

Create new iceberg charts.

Delete existing charts (this will also delete all associated layers and entries).

Click "Edit" on a chart to manage its layers and entries. You can add new layers, delete existing ones, and add or remove entries within each layer.