# Iceberg Chart Explainer

Welcome to the Iceberg Chart Explainer, a powerful, self-hosted alternative to websites like `icebergcharts.com`. This application allows you to create, manage, and explore your own iceberg charts, with explanations for every entry dynamically generated by Google's state-of-the-art AI.

This platform is built for communities, content creators, and enthusiasts who want a dedicated space to build and share deep dives into any topic imaginable.

![App Screenshot](https://res.cloudinary.com/deak3thl9/image/upload/v1754206979/Screenshot_2025-08-03_144145_vxlfwz.png)

## âœ¨ Features

-   **Self-Hosted & Your Data**: You have full control over your data, hosted on your own free Supabase instance.
-   **AI-Powered Explanations**: Uses Google's Gemma models via the AI Studio API and Google Custom Search to provide rich, context-aware explanations for any iceberg entry.
-   **Intelligent Homepage**:
    -   **AI Categorization**: Automatically groups your iceberg charts into topics (e.g., "Gaming," "Media," "History") for easy navigation. This is a one-time process you can run, ensuring a fast user experience.
    -   **AI Recommendations**: A powerful search bar that uses AI to analyze a user's query and recommend the most relevant iceberg charts.
-   **Full CRUD Management**: A user-friendly web interface to Create, Read, Update, and Delete charts, layers, and entries without ever touching the database directly.
-   **Smart Image Handling**:
    -   **Image Proxy**: Bypasses hotlink protection from external sites, ensuring images are always displayed correctly.
    -   **Image Refresh**: A simple button allows users to fetch a new image if the first one isn't suitable.
-   **Efficient & Fast**:
    -   **Client-Side Caching**: Explanations are cached in the user's browser session, minimizing redundant API calls and speeding up navigation.
-   **Easy Deployment**: Designed for simple, one-click deployment on platforms like Vercel.

![App Screenshot](https://res.cloudinary.com/deak3thl9/image/upload/v1754392661/Screenshot_2025-08-05_174106_mplpae.png)

## âš ï¸ A Note on Content & Copyright

This project is a **tool** for creating and hosting your own original content. It is not intended for, and does not encourage, the violation of copyright by scraping or copying content from other websites like `icebergcharts.com`.

**Please use this application ethically.** The built-in management UI is designed to make it easy to create your own charts from scratch. We strongly encourage you to populate your database with your own research and community-contributed knowledge.

## ðŸ› ï¸ Technology Stack

-   **Backend**: Flask (Python)
-   **Database**: Supabase (PostgreSQL)
-   **AI**: Google AI Studio (Gemma models)
-   **Search**: Google Custom Search JSON API
-   **Frontend**: Tailwind CSS, Vanilla JavaScript

---

## ðŸš€ Full Setup & Deployment Guide

Follow these steps to get your own instance of the Iceberg Chart Explainer running.

### Step 1: Prerequisites

-   A [Supabase](https://supabase.com) account (free tier is sufficient).
-   A [Google Cloud](https://cloud.google.com/) account for API keys.
-   Python 3.8+ and `pip` installed on your local machine.
-   [Git](https://git-scm.com/) installed on your local machine.

### Step 2: Supabase Setup

1.  **Create a Supabase Project**: Go to your Supabase dashboard and create a new project.
2.  **Get API Credentials**: In your new project, navigate to **Project Settings > API**. Keep this page open, as you will need the **Project URL** and the `anon` **public key**.
3.  **Run the SQL Schema**: Go to the **SQL Editor**, paste the entire content of the `supabase_schema.sql` file from this repository, and click **Run**. This will create all the necessary tables and policies.

### Step 3: Google API Setup

1.  **Google AI Studio API Key**:
    -   Go to [Google AI Studio](https://aistudio.google.com/app/apikey).
    -   Create a new API key and copy it.
2.  **Google Custom Search API Key & Engine ID**:
    -   Go to the [Google Cloud Console](https://console.cloud.google.com/) and create a new project.
    -   Enable the **Custom Search API**.
    -   Go to the **Credentials** page and create a new API Key. Copy this key.
    -   Go to the [Programmable Search Engine](https://programmablesearchengine.google.com/controlpanel/all) page.
    -   Create a new search engine. In the setup, select the option to **Search the entire web**.
    -   Once created, find and copy the **Search engine ID**.
    -   **Crucially**, make sure the **Image search** toggle is turned **ON** in your search engine's settings.

### Step 4: Local Project Setup

1.  **Clone the Repository**:
    ```bash
    git clone <repository_url>
    cd iceberg-explainer
    ```
2.  **Create and Activate a Virtual Environment**:
    ```bash
    python -m venv venv
    # Windows: .\venv\Scripts\activate
    # macOS/Linux: source venv/bin/activate
    ```
3.  **Install Dependencies**:
    ```bash
    pip install -r requirements.txt
    ```
4.  **Configure Environment Variables**:
    -   Create a file named `.env` in the root of the project.
    -   Copy the contents of `.env.example` (if provided) or add the following, filling in your own keys:
    ```env
    # Google APIs
    GEMINI_API_KEY=YOUR_GEMINI_API_KEY_HERE
    CUSTOM_SEARCH_API_KEY=YOUR_CUSTOM_SEARCH_API_KEY_HERE
    CUSTOM_SEARCH_ENGINE_ID=YOUR_SEARCH_ENGINE_ID_HERE

    # Supabase
    SUPABASE_URL=YOUR_SUPABASE_PROJECT_URL_HERE
    SUPABASE_ANON_KEY=YOUR_SUPABASE_ANON_KEY_HERE

    # Flask
    SECRET_KEY=generate_a_random_string_for_this
    ```

### Step 5: Populating Your Database

You have two options to add charts:

-   **(Option A) Manual Entry**: Run the app (see next step) and navigate to the `/manage` page. From here, you can create new charts, add layers, and add entries one by one. This is the recommended method for creating original content.
-   **(Option B) Bulk Migration**: If you have existing data in the same JSON format as the project's examples, you can:
    1.  Create a directory named `icebergs` in the project root.
    2.  Place your `.json` files inside it.
    3.  Run the migration script: `python migrate_to_supabase.py`.

### Step 6: Running Locally

Start the development server:
```bash
flask run
```
The app will be available at `http://127.0.0.1:5000`.

### Step 7: Deploying to Vercel (Recommended)

1.  **Push to GitHub**: Make sure your project is pushed to a GitHub repository.
2.  **Import to Vercel**: Go to your Vercel dashboard, click "Add New... > Project," and import your GitHub repository.
3.  **Configure Environment Variables**: In the Vercel project settings, go to **Settings > Environment Variables**. Add all the same keys and values from your `.env` file.
4.  **Deploy**: Vercel will automatically build and deploy your application using the `vercel.json` file. Your site will be live in minutes!

## ðŸ“– How to Use the App

-   **Homepage**: Browse charts by AI-generated categories or use the search bar to get AI-powered recommendations for a specific topic.
-   **Iceberg Page**: Click on any entry to get a detailed explanation and a relevant image. If you don't like the image, click the refresh icon on the image to get a new one.
-   **Management Panel (`/manage`)**:
    -   Add or delete entire iceberg charts.
    -   Edit a chart to manage its layers and entries.
    -   **Important**: After adding new charts, click the **"Categorize New Charts"** button. This will run the one-time AI process to assign categories to your new charts so they appear correctly on the homepage.
